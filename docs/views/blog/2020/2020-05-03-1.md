---
title: 这个博客是如何搭建的?
date: 2020-05-03
sidebarDepth: 1
tags:
 - blog
 - VuePress
 - nginx
categories: 
 - 网站搭建
---

在Linux上搭建一个VuePress静态博客
<!-- more -->

## 前期准备工作
购置一台云服务器，我选择了阿里云的学生版轻量应用服务器。选择系统镜像，CentOS7.3  
[阿里云](https://promotion.aliyun.com/ntms/act/campus2018.html)  
![An image](/blog/2020-05-03/alicloud.jpg)
::: tip
如果你想要为自己的博客设置一个域名，请购买至少3个月的服务器使用期限，因为不足3个月的服务器将无法进行工信部网站备案。
:::
## 安装Node.JS
参考[这篇文章](https://blog.csdn.net/ziwoods/article/details/83751842)
## 安装VuePress
这里直接安装VuePress的一个博客模板  
[官方文档:vuepress-theme-reco](https://vuepress-theme-reco.recoluan.com/)  
``` sh
#全局安装reco的theme-cli
npm install @vuepress-reco/theme-cli -g

#安装完之后初始化一个名为‘my-blog’的项目 名字可以自定义
#初始化前会让你输入这个项目的相关信息，可以随意填写.最后一项主页风格选择blog
theme-cli init my-blog

#安装完之后进入my-blog文件夹
cd my-blog

#安装相关依赖
npm install

#开发环境调试,如果一切顺利，在执行npm run dev后在浏览器URL中输入 IP:8080 即可看到如下图效果
npm run dev
```
![An image](/blog/2020-05-03/model.jpg)

::: tip
如果访问8080端口没有效果，可能是服务器防火墙没有开放8080端口。
去轻量云服务器管理后台开放8080端口为TCP即可
![An image](https://i.loli.net/2020/05/03/DuQynfoFjL6ANBS.jpg)
:::

## 安装Nginx
[参考这篇文章](https://blog.csdn.net/gjm15652957971/article/details/92806043)
#### 添加nginx服务
``` sh
cd /etc/init.d/

#新建一个名为nginx脚本文件
vim nginx
```
#### 输入以下代码
::: details
``` sh
#!/bin/sh
# nginx - this script starts and stops the nginx daemin
#
# chkconfig:   - 85 15

# description:  Nginx is an HTTP(S) server, HTTP(S) reverse \
#               proxy and IMAP/POP3 proxy server

# processname: nginx
# config:      /usr/local/nginx/conf/nginx.conf
# pidfile:     /usr/local/nginx/logs/nginx.pid

# Source function library.

. /etc/rc.d/init.d/functions

# Source networking configuration.

. /etc/sysconfig/network

# Check that networking is up.

[ "$NETWORKING" = "no" ] && exit 0

nginx="/usr/local/nginx/sbin/nginx"

prog=$(basename $nginx)

NGINX_CONF_FILE="/usr/local/nginx/conf/nginx.conf"

lockfile=/var/lock/subsys/nginx

start() {

    [ -x $nginx ] || exit 5

    [ -f $NGINX_CONF_FILE ] || exit 6

    echo -n $"Starting $prog: "

    daemon $nginx -c $NGINX_CONF_FILE

    retval=$?

    echo

    [ $retval -eq 0 ] && touch $lockfile

    return $retval

}


stop() {

    echo -n $"Stopping $prog: "

    killproc $prog -QUIT

    retval=$?

    echo

    [ $retval -eq 0 ] && rm -f $lockfile

    return $retval

}



restart() {

    configtest || return $?

    stop

    start

}


reload() {

    configtest || return $?

    echo -n $"Reloading $prog: "

    killproc $nginx -HUP

    RETVAL=$?

    echo

}

force_reload() {

    restart

}


configtest() {

  $nginx -t -c $NGINX_CONF_FILE

}



rh_status() {

    status $prog

}


rh_status_q() {

    rh_status >/dev/null 2>&1

}

case "$1" in

    start)

        rh_status_q && exit 0
        $1
        ;;

    stop)


        rh_status_q || exit 0
        $1
        ;;

    restart|configtest)
        $1
        ;;

    reload)
        rh_status_q || exit 7
        $1
        ;;


    force-reload)
        force_reload
        ;;
    status)
        rh_status
        ;;


    condrestart|try-restart)

        rh_status_q || exit 0
            ;;

    *)

        echo $"Usage: $0 {start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest}"
        exit 2

esac
```
:::
#### 给脚本文件添加读写权限
``` sh
cd /etc/init.d/
chmod 777 /etc/init.d/nginx
chkconfig --add nginx

#nginx服务的相关指令
service start nginx #启动nginx
service stop nginx  #关闭nginx
service restart nginx #重启nginx
```

## 部署
#### 打包VuePress项目
``` sh
cd /root/my-blog/
npm run build
```
执行以上命令后在my-blog项目下会出现一个public文件夹
#### 修改nginx配置
``` sh
vim /usr/local/nginx/conf/nginx.conf
```

``` sh
    server {
        listen       80;
        server_name  localhost;
        ...
        location / {
            root   /home/my-blog/public;     //将root后面的路径指向public文件夹
            index  index.html index.htm;
            try_files $uri $uri/ /index.html;
        }
        ...
        }
```

#### 重启nginx服务
``` sh
service nginx reload
```
如果一切顺利，此时访问IP即可看到网站页面
